<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/header.ejs') %>
        <title>Today's Orders</title>
</head>
<body>
    <%- include('partials/navbarSelection.ejs') %>

    <!-- Title -->
    
    <h3 class="text-center mb-4" style="margin-top: 20px;">Today's orders</h3>
    
    <% orders.forEach(function(order) { %>
    <div class="container" style="margin-top: 30px;">
        <table class="table table-bordered w-100">
            <tbody>
                <!-- Á¨¨‰∏ÄÂ±ÇÔºöËÆ¢ÂçïÂü∫Êú¨‰ø°ÊÅØ -->
                <% if (order.status === s_confirmed) { %>
                    <tr style="background-color: #e0ffe0; border-top: 2px solid brown;">
                                            <td colspan="6" style="padding: 8px;">
                        <span class="fw-bold" style="font-size: 18px; color: red;">
                <% } else { %>
                    <tr style="background-color: #e0ffe0; border-top: 2px solid #455045;"></tr>
                        <td colspan="6" style="padding: 8px;">
                        <span class="fw-bold" style="font-size: 18px; color: #2a6c2a;">
                <% } %>
                            üçΩÔ∏è Table Number: <%= order.tablenumber %>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="width: 10%;"><label class="fw-bold">Status:</label></td>
                    <td style="color:brown; width: 20%;"><%= order.statusname %></td>
                    <td style="width: 10%;"><label class="fw-bold">Number:</label></td>
                    <td style="width: 20%;"><%= order.total_quantity %></td>
                    <td style="width: 10%;"><label class="fw-bold">TotalAmount:</label></td>
                    <td style="width: 20%;"><%= order.total_amount %></td>
                </tr>
                <tr>
                    <td style="width: 10%;"><label class="fw-bold">Creator:</label></td>
                    <td style="width: 20%;"><%= order.creator %></td>
                    <td style="width: 10%;"><label class="fw-bold">StartTime:</label></td>
                    <td style="width: 20%;"><%= order.ordertime %></td>
                    <td style="width: 10%;"><label class="fw-bold">FinishTime:</label></td>
                    <% if (order.finishtime !== '0000-00-00 00:00:00') { %>
                        <td style="width: 20%;"><%= order.finishtime %></td>
                    <% } else { %>
                        <td style="width: 20%;"></td>
                    <% } %>
                </tr>

                <!-- Á¨¨‰∫åÂ±ÇÂµåÂ•óÔºöÂïÜÂìÅÊòéÁªÜË°®Ê†º -->
                <tr>
                    <td colspan="6">
                        <table class="table table-sm table-bordered table-striped mb-0">
                            <thead class="table-secondary">
                                <tr>
                                    <th>Item</th>
                                    <th>Price</th>
                                    <th>Discount</th>
                                    <th>CurPrice</th>
                                    <th>Number</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% items.forEach(function(item) {
                                    if (item.orderid === order.id) { %>
                                        <tr>
                                            <td><%= item.itemname %></td>
                                            <td>$<%= parseFloat(item.price).toFixed(2) %></td>
                                            <td style="text-align: center;">
                                                <% if (item.discount > 0) { %>
                                                    <span style="color: brown; font-weight: bold;"><%= item.discount %>% OFF</span>
                                                <% } else { %>
                                                    <span>None</span>
                                                <% }  %>
                                            </td>
                                            <td style="text-align: center;"><%= parseFloat(item.curprice).toFixed(2) %> %></td>
                                            <td style="text-align: center;"><%= item.itemnumber %></td>
                                            <td><%= item.statusname %></td>
                                            <td style="text-align: center;">
                                                <div style="display: flex; justify-content: space-evenly;">
                                                    <% if (item.status === s_preparing) { %>
                                                        <form action="/ReadyItem" method="POST">
                                                            <input name="itemId" type="hidden" value="<%= item.id %>">
                                                            <input name="orderId" type="hidden" value="<%= order.id %>">
                                                            <button class="btn btn-sm btn-warning">Ready</button>
                                                        </form>
                                                    <% } %>
                                                
                                                    <% if (item.status < s_ready) { %>
                                                        <form action="/deleteItemByR" method="POST" class="delete-form"
                                                            onsubmit="return confirm('Are you sure you want to delete this item?');">
                                                            <input name="itemId" type="hidden" value="<%= item.id %>">
                                                            <input name="orderId" type="hidden" value="<%= order.id %>">
                                                            <button class="btn btn-sm btn-danger">Delete</button>
                                                        </form>
                                                    <% } %>
                                                </div>
                                            </td>
                                        </tr>
                                <% } }); %>
                            </tbody>
                        </table>
                    </td>
                </tr>

                <!-- button   -->
                <tr>
                    <td colspan="6">
                        <div style="display: flex; justify-content: space-evenly;">
                            <% if (order.status===s_confirmed) { %>
                                <form action="/receiveOrder" method="POST">
                                    <input name="orderId" type="hidden" value="<%= order.id %>">
                                    <button class="btn btn-primary">Receive</button>
                                </form>
                            <% } %>

                            <% if (order.status===s_ready) { %>
                                <form action="/finishOrder" method="POST">
                                    <input name="orderId" type="hidden" value="<%= order.id %>">
                                    <button class="btn btn-primary">Finish</button>
                                </form>
                            <% } %>
                        
                             <% if (order.status < s_ready) { %>
                            <form action="/cancelOrder" method="POST"
                                onsubmit="return confirm('Are you sure you want to cancel this order?');">
                                <input name="orderId" type="hidden" value="<%= order.id %>">
                                <button class="btn btn-primary">Cancel</button>
                            </form>
                            <% } %>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <% }); %>

    <%- include('partials/footer.ejs') %>



</body>
</html>


